# 1장. 계층형 아키텍처의 문제는 무엇일까?

- 계층형 아키텍처의 문제는 무엇일까?
  - 계층형 아키텍처는 데이터베이스 주도 설계를 유도한다.
- 계층형 아키텍처의 문제점
  - 지름길을 택하기 쉬워진다.
  - 테스트하기 어려워진다.
  - 유스케이스를 숨긴다.
  - 동시 작업이 어려워진다.
- 마무리

## 계층형 아키텍처의 문제는 무엇일까?

계층(Layer)으로 구성된 웹 어플리케이션의 구조는 **웹**, **도메인**, **영속성**으로 이루어진 전통적인 웹 어플리케이션 구조이다.

계층형 아키텍처는 견고한 아키텍처 패턴이지만 계층형 아키텍처는 코드에 나쁜 습관들이 스며들기 쉽다.

또한 시간이 지날수록 소프트웨어를 점점 더 변경하기 어렵게 만드는 허점들을 노출한다.

### 계층형 아키텍처는 데이터베이스 주도 설계를 유도한다.

전통적인 계층형 아키턱처의 토대는 데이터베이스이다. 

여기서 오는 문제는 비즈니스 로직을 작성하는데 요구사항 구현에 초점을 맞춰야한다.

이 과정에서 데이터 베이스 중심적인 설계 개발로 ORM프레임워크를 사용하는 것이다.

## 계층형 아키텍처의 문제점

### 데이터베이스 기반의 설계를 유도한다.

전통적인 Layered Architecture는 데이터베이스에 기초한다. 이는 몇몇 이유에서 문제가 있다.

먼저 비즈니스 로직을 작성하는데는 오로지 비즈니즈 로직의 요구사항을 이해하고 정확하게 구현하는 것에 초점을 맞춰야한다. 그래야 이를 바탕으로 Persistence와 Web 레이어를 구축할 수 있다.

이 과정에서 데이터베이스 중심적인 설계를 불러오는 요소는 ORM 프레임워크를 사용하는 것이다. ORM 프레임워크를 Layered Architecture에 함께 사용하는 것은 Persistence 측면에서 비즈니스 로직을 녹일 우려가 있다.

Domain 레이어의 Entity는 Persistence 레이어와 강한 결합을 이끌게 된다. 이는 도메인 로직을 구현하면서 eager, lazy 로딩 문제, 트랜잭션 관리, 캐시 초기화 등의 문제들을 신경쓰게 만든다.

영속성 코드가 사실상 도메인 코드에 녹아들어가서 하나만 바꾸는 것이 어려워 지고, 개발과정에서 유연하고 선택의 폭을 넓혀주는 계층형 아키텍처의 목표와 정확히 반대되는 상황이다.

> 즉, 데이터베이스 중심적인 아키텍처가 만들어지는 가장 큰 원인은 ORM (ex. JPA, Hibernate)로 객체 관계 맵핑을 사용하기 떄문이다. 

## 마무리

계층형 아키텍처는 많은 것들이 잘못된 방향으로 흘러가도록 용인한다.

엄격한 지기 훈련을 통해서 ORM과 행동 중심 모델리의 아키텍처를 구현한다.

계층형 아키텍처 스타일로 유지보수 하기에 더 쉬운 솔루션을 만들 수 있도록 노력한다.

